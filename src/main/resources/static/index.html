<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iBanking - Thanh to√°n h·ªçc ph√≠</title>
    <style>
		/* üåø Reset c∆° b·∫£n & font */
		body {
		    font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
		    background: linear-gradient(135deg, #e8f0f7, #f9fbfc);
		    margin: 0;
		    padding: 20px;
		    display: flex;
		    justify-content: center;
		    align-items: center;
		    min-height: 100vh;
		}
		
		/* üß≠ Container ch√≠nh */
		.container {
		    background-color: #fff;
		    padding: 35px 40px;
		    border-radius: 14px;
		    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
		    width: 100%;
		    max-width: 520px;
		    transition: transform 0.2s ease, box-shadow 0.2s ease;
		}
		.container:hover {
		    transform: translateY(-2px);
		    box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1);
		}
		
		/* üß© Ti√™u ƒë·ªÅ */
		h1, h2 {
		    text-align: center;
		    color: #2c3e50;
		    margin-bottom: 25px;
		    letter-spacing: 0.5px;
		}
		
		/* üåê View chuy·ªÉn tab */
		.view {
		    display: none;
		}
		.view.active {
		    display: block;
		}
		
		/* üì¶ Form styling */
		.form-group {
		    margin-bottom: 20px;
		}
		.form-group label {
		    display: block;
		    margin-bottom: 6px;
		    font-weight: 600;
		    color: #34495e;
		}
		.form-group input[type="text"],
		.form-group input[type="password"],
		.form-group input[type="email"] {
		    width: 100%;
		    padding: 12px 14px;
		    border: 1px solid #ced6e0;
		    border-radius: 8px;
		    box-sizing: border-box;
		    font-size: 15px;
		    transition: border-color 0.2s ease, box-shadow 0.2s ease;
		}
		.form-group input:focus {
		    outline: none;
		    border-color: #3498db;
		    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.15);
		}
		.form-group input[readonly] {
		    background-color: #f4f6f7;
		    cursor: not-allowed;
		}
		
		/* üé® Buttons */
		.button {
		    background-color: #3498db;
		    color: white;
		    padding: 14px 20px;
		    margin: 10px 0;
		    border: none;
		    border-radius: 8px;
		    cursor: pointer;
		    width: 100%;
		    font-size: 16px;
		    font-weight: 600;
		    letter-spacing: 0.3px;
		    transition: background-color 0.2s ease, transform 0.15s ease;
		}
		.button:hover:not(:disabled) {
		    background-color: #2e86c1;
		    transform: translateY(-1px);
		}
		.button:disabled {
		    background-color: #bdc3c7;
		    cursor: not-allowed;
		}
		.button-secondary {
		    background-color: #95a5a6;
		}
		.button-secondary:hover:not(:disabled) {
		    background-color: #7f8c8d;
		}
		.button-danger {
		    background-color: #e74c3c;
		}
		.button-danger:hover:not(:disabled) {
		    background-color: #c0392b;
		}
		
		/* üì• Input group (input + button) */
		.input-group {
		    display: flex;
		}
		.input-group input {
		    flex-grow: 1;
		    border-top-right-radius: 0;
		    border-bottom-right-radius: 0;
		}
		.input-group button {
		    border-top-left-radius: 0;
		    border-bottom-left-radius: 0;
		    margin: 0;
		    white-space: nowrap;
		}
		
		/* ‚úÖ Checkbox */
		.checkbox-group {
		    display: flex;
		    align-items: center;
		}
		.checkbox-group input {
		    margin-right: 10px;
		}
		
		/* üó®Ô∏è Th√¥ng b√°o */
		.message {
		    text-align: center;
		    padding: 15px;
		    margin: 20px 0;
		    border-radius: 8px;
		    font-weight: 500;
		}
		.message.success {
		    background-color: #eafaf1;
		    color: #1e8449;
		    border: 1px solid #a9dfbf;
		}
		.message.error {
		    background-color: #fdecea;
		    color: #c0392b;
		    border: 1px solid #f5b7b1;
		}
		
		/* üìä B·∫£ng l·ªãch s·ª≠ giao d·ªãch */
		#history-table {
		    width: 100%;
		    border-collapse: collapse;
		    margin-bottom: 25px;
		    border-radius: 8px;
		    overflow: hidden;
		    box-shadow: 0 0 0 1px #e5e8eb;
		}
		#history-table th, #history-table td {
		    padding: 12px 14px;
		    text-align: left;
		    font-size: 14px;
		}
		#history-table th {
		    background-color: #f4f7fb;
		    color: #2c3e50;
		    font-weight: 600;
		    border-bottom: 2px solid #e0e6ed;
		}
		#history-table tbody tr {
		    transition: background-color 0.15s ease;
		}
		#history-table tbody tr:nth-child(even) {
		    background-color: #fafbfc;
		}
		#history-table tbody tr:hover {
		    background-color: #eef5fb;
		}
		.status-success {
		    color: #27ae60;
		    font-weight: 600;
		}
		.status-failed {
		    color: #e74c3c;
		    font-weight: 600;
		}
		</style>

</head>
<body>

<div class="container">
    
    <div id="login-view" class="view active">
        <h1>iBanking</h1>
        <form id="login-form">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" required value="nguyenvana">
            </div>
            <div class="form-group">
                <label for="password">M·∫≠t kh·∫©u</label>
                <input type="password" id="password" required value="password123">
            </div>
            <div id="login-error" class="message error" style="display: none;"></div>
            <button type="submit" class="button">ƒêƒÉng nh·∫≠p</button>
        </form>
    </div>

    <div id="payment-view" class="view">
        <h2>Thanh to√°n h·ªçc ph√≠ TDTU</h2>
        
        <div class="form-group" style="text-align: right; margin-bottom: 10px;">
            <button type="button" id="view-history-btn" class="button-secondary" style="width: auto; padding: 10px 15px;">Xem L·ªãch s·ª≠</button>
        </div>

        <fieldset>
            <legend><h4>Th√¥ng tin ng∆∞·ªùi tr·∫£</h4></legend>
            <div class="form-group">
                <label for="payer-name">H·ªç t√™n</label>
                <input type="text" id="payer-name" readonly>
            </div>
            <div class="form-group">
                <label for="payer-phone-number">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="text" id="payer-phone-number" readonly>
            </div>
            <div class="form-group">
                <label for="payer-email">Email</label>
                <input type="text" id="payer-email" readonly>
            </div>
        </fieldset>

        <fieldset>
            <legend><h4>Th√¥ng tin h·ªçc ph√≠</h4></legend>
            <div class="form-group">
                <label for="student-id">M√£ s·ªë sinh vi√™n (MSSV)</label>
                <div class="input-group">
                    <input type="text" id="student-id" placeholder="Nh·∫≠p MSSV c·∫ßn thanh to√°n">
                    <button type="button" id="find-student-btn" class="button">T√¨m</button>
                </div>
            </div>
            <div class="form-group">
                <label for="student-name">T√™n sinh vi√™n</label>
                <input type="text" id="student-name" readonly>
            </div>
            <div class="form-group">
                <label for="tuition-amount">S·ªë ti·ªÅn (VND)</label>
                <input type="text" id="tuition-amount" readonly>
            </div>
        </fieldset>

        <fieldset>
            <legend><h4>Th√¥ng tin thanh to√°n</h4></legend>
            <div class="form-group">
                <label for="available-balance">S·ªë d∆∞ kh·∫£ d·ª•ng (VND)</label>
                <input type="text" id="available-balance" readonly>
            </div>
            <div class="form-group">
                <label for="payment-summary-amount">S·ªë ti·ªÅn thanh to√°n (VND)</label>
                <input type="text" id="payment-summary-amount" readonly>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="terms-checkbox">
                <label for="terms-checkbox">T√¥i ƒë·ªìng √Ω v·ªõi c√°c ƒëi·ªÅu kho·∫£n</label>
            </div>
        </fieldset>

        <div id="payment-error" class="message error" style="display: none;"></div>
        <button type="button" id="initiate-payment-btn" class="button" disabled>X√°c nh·∫≠n Giao d·ªãch</button>
    </div>

    <div id="otp-view" class="view">
        <h2>X√°c th·ª±c Giao d·ªãch</h2>
        <p>M√£ OTP ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email <strong id="otp-email-display"></strong>. Vui l√≤ng nh·∫≠p m√£ OTP ƒë·ªÉ ho√†n t·∫•t.</p>
        <div class="form-group">
            <label for="otp-code">M√£ OTP (6 s·ªë)</label>
            <input type="text" id="otp-code" maxlength="6" placeholder="Nh·∫≠p m√£ OTP">
        </div>
        <div id="otp-error" class="message error" style="display: none;"></div>
        <button type="button" id="confirm-payment-btn" class="button">Ho√†n t·∫•t Thanh to√°n</button>
    </div>

    <div id="result-view" class="view">
        <h2>K·∫øt qu·∫£ Giao d·ªãch</h2>
        <div id="result-message" class="message"></div>
        <button type="button" id="new-payment-btn" class="button">Th·ª±c hi·ªán Giao d·ªãch M·ªõi</button>
    </div>

    <div id="history-view" class="view">
        <h2>L·ªãch s·ª≠ Giao d·ªãch</h2>
        <table id="history-table">
            <thead>
                <tr>
                    <th>Th·ªùi gian</th>
                    <th>Sinh vi√™n</th>
                    <th>S·ªë ti·ªÅn (VND)</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>M√¥ t·∫£</th>
                </tr>
            </thead>
            <tbody id="history-table-body">
                </tbody>
        </table>
        <button type="button" id="back-to-payment-btn" class="button button-secondary">Quay l·∫°i</button>
    </div>

</div> <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Bi·∫øn to√†n c·ª•c (Global State) ---
        let jwtToken = null; // THAY ƒê·ªîI: D√πng JWT token thay v√¨ username
        let currentStudentId = null;
        let tuitionAmount = 0;
        let payerEmail = ''; // L∆∞u email ng∆∞·ªùi tr·∫£

        // --- DOM Elements (C√°c ƒë·ªëi t∆∞·ª£ng HTML) ---
        const views = document.querySelectorAll('.view');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        
        const payerNameInput = document.getElementById('payer-name');
        const payerPhoneNumberInput = document.getElementById('payer-phone-number');
        const payerEmailInput = document.getElementById('payer-email');
        const availableBalanceInput = document.getElementById('available-balance');
        
        const studentIdInput = document.getElementById('student-id');
        const findStudentBtn = document.getElementById('find-student-btn');
        const studentNameInput = document.getElementById('student-name');
        const tuitionAmountInput = document.getElementById('tuition-amount');
        
        const paymentSummaryAmountInput = document.getElementById('payment-summary-amount');
        const termsCheckbox = document.getElementById('terms-checkbox');
        const paymentError = document.getElementById('payment-error');
        const initiatePaymentBtn = document.getElementById('initiate-payment-btn');

        const otpEmailDisplay = document.getElementById('otp-email-display');
        const otpCodeInput = document.getElementById('otp-code');
        const otpError = document.getElementById('otp-error');
        const confirmPaymentBtn = document.getElementById('confirm-payment-btn');

        const resultMessage = document.getElementById('result-message');
        const newPaymentBtn = document.getElementById('new-payment-btn');

        // M·ªöI: C√°c element c·ªßa L·ªãch s·ª≠ Giao d·ªãch
        const viewHistoryBtn = document.getElementById('view-history-btn');
        const historyTableBody = document.getElementById('history-table-body');
        const backToPaymentBtn = document.getElementById('back-to-payment-btn');

        // --- H√†m Ti·ªán √≠ch (Utility Functions) ---
        
        // H√†m hi·ªÉn th·ªã m·ªôt view v√† ·∫©n c√°c view kh√°c
        const showView = (viewId) => {
            views.forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');
        };

        // H√†m hi·ªÉn th·ªã l·ªói
        const showError = (element, message) => {
            element.textContent = message;
            element.style.display = 'block';
        };

        // H√†m ·∫©n l·ªói
        const hideError = (element) => {
            element.style.display = 'none';
        };
        
        // H√†m format ti·ªÅn t·ªá
        const formatCurrency = (value) => new Intl.NumberFormat('vi-VN').format(value);

        // --- H√†m Logic Ch√≠nh (Core Logic Functions) ---

        /**
         * 1. H√ÄM ƒêƒÇNG NH·∫¨P (ƒê√É VI·∫æT L·∫†I HO√ÄN TO√ÄN)
         * G·ªçi /api/auth/login ƒë·ªÉ l·∫•y JWT token
         */
        const handleLogin = async (event) => {
            event.preventDefault();
            hideError(loginError);
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (!response.ok) {
                    throw new Error('Username ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c.');
                }
                const data = await response.json();
                jwtToken = data.token; // L∆∞u token v√†o bi·∫øn to√†n c·ª•c

                // ƒêƒÉng nh·∫≠p th√†nh c√¥ng, t·∫£i th√¥ng tin ng∆∞·ªùi tr·∫£ v√† hi·ªÉn th·ªã form
                await loadPayerInfo(); 
                
            } catch (error) {
                showError(loginError, error.message);
            }
        };
        
        /**
         * 2. H√ÄM T·∫¢I TH√îNG TIN NG∆Ø·ªúI TR·∫¢ (M·ªöI)
         * D√πng token ƒë·ªÉ g·ªçi /api/payment/payer-info
         */
        const loadPayerInfo = async () => {
             if (!jwtToken) return; // N·∫øu kh√¥ng c√≥ token, kh√¥ng l√†m g√¨ c·∫£
             
             try {
                const response = await fetch('/api/payment/payer-info', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${jwtToken}` // G·ª¨I TOKEN L√äN
                    }
                });

                if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ng∆∞·ªùi d√πng.');
                
                const data = await response.json();
                
                // L∆∞u th√¥ng tin ng∆∞·ªùi tr·∫£
                payerEmail = data.email;
                
                // ƒêi·ªÅn th√¥ng tin v√†o form
                payerNameInput.value = data.fullName;
                payerPhoneNumberInput.value = data.phoneNumber;
                payerEmailInput.value = data.email;
                availableBalanceInput.value = formatCurrency(data.availableBalance);
                otpEmailDisplay.textContent = data.email; // C·∫≠p nh·∫≠t email cho m√†n h√¨nh OTP

                showView('payment-view'); // Hi·ªÉn th·ªã form thanh to√°n

             } catch(error) {
                // N·∫øu token h·∫øt h·∫°n ho·∫∑c l·ªói, quay v·ªÅ trang login
                jwtToken = null;
                showView('login-view');
                showError(loginError, 'Phi√™n ƒëƒÉng nh·∫≠p h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
             }
        };

        /**
         * 3. H√ÄM T√åM SINH VI√äN
         * G·ªçi /api/payment/student-info
         */
        const handleFindStudent = async () => {
            hideError(paymentError);
            const studentId = studentIdInput.value;
            if (!studentId) {
                showError(paymentError, 'Vui l√≤ng nh·∫≠p M√£ s·ªë sinh vi√™n.');
                return;
            }

            try {
                const response = await fetch(`/api/payment/student-info/${studentId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${jwtToken}` // G·ª¨I TOKEN L√äN
                    }
                });
                
                if (!response.ok) {
                    const errorMsg = await response.text();
                    throw new Error(errorMsg || 'Kh√¥ng t√¨m th·∫•y sinh vi√™n.');
                }
                
                const data = await response.json();
                
                if (data.tuitionAmount <= 0) {
                     showError(paymentError, 'Sinh vi√™n n√†y ƒë√£ thanh to√°n h·ªçc ph√≠.');
                     resetStudentFields();
                     return;
                }

                // ƒêi·ªÅn th√¥ng tin sinh vi√™n
                studentNameInput.value = data.fullName;
                tuitionAmountInput.value = formatCurrency(data.tuitionAmount);
                paymentSummaryAmountInput.value = formatCurrency(data.tuitionAmount);
                
                // L∆∞u l·∫°i
                currentStudentId = data.studentId;
                tuitionAmount = data.tuitionAmount;
                
                validatePaymentForm(); // Ki·ªÉm tra l·∫°i form
                
            } catch (error) {
                showError(paymentError, error.message);
                resetStudentFields();
            }
        };

        // H√†m reset th√¥ng tin SV n·∫øu t√¨m l·ªói
        const resetStudentFields = () => {
             studentNameInput.value = '';
             tuitionAmountInput.value = '';
             paymentSummaryAmountInput.value = '';
             currentStudentId = null;
             tuitionAmount = 0;
             validatePaymentForm();
        };

        // H√†m ki·ªÉm tra form ƒë·ªÉ b·∫≠t/t·∫Øt n√∫t "X√°c nh·∫≠n"
        const validatePaymentForm = () => {
            const balance = parseFloat(availableBalanceInput.value.replace(/\./g, ''));
            const isStudentFound = currentStudentId && tuitionAmount > 0;
            const isTermsChecked = termsCheckbox.checked;
            const hasEnoughBalance = balance >= tuitionAmount;
            
            if (isStudentFound && !hasEnoughBalance) {
                 showError(paymentError, 'S·ªë d∆∞ kh√¥ng ƒë·ªß ƒë·ªÉ th·ª±c hi·ªán giao d·ªãch.');
            } else if (paymentError.textContent === 'S·ªë d∆∞ kh√¥ng ƒë·ªß ƒë·ªÉ th·ª±c hi·ªán giao d·ªãch.') {
                 hideError(paymentError);
            }

            initiatePaymentBtn.disabled = !(isStudentFound && isTermsChecked && hasEnoughBalance);
        };

        /**
         * 4. H√ÄM KH·ªûI T·∫†O THANH TO√ÅN (L·∫•y OTP)
         * G·ªçi /api/payment/initiate
         */
        const handleInitiatePayment = async () => {
            hideError(paymentError);
            initiatePaymentBtn.disabled = true;
            initiatePaymentBtn.textContent = 'ƒêang x·ª≠ l√Ω...';
            
            try {
                const response = await fetch('/api/payment/initiate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${jwtToken}` // G·ª¨I TOKEN L√äN
                    },
                    // THAY ƒê·ªîI: Ch·ªâ g·ª≠i studentId, kh√¥ng g·ª≠i username
                    body: JSON.stringify({ studentId: currentStudentId }) 
                });

                if (!response.ok) {
                    const errorMsg = await response.text();
                    throw new Error(errorMsg);
                }

                // Th√†nh c√¥ng, chuy·ªÉn sang m√†n h√¨nh OTP
                showView('otp-view');

            } catch (error) {
                showError(paymentError, error.message);
            } finally {
                initiatePaymentBtn.disabled = false;
                initiatePaymentBtn.textContent = 'X√°c nh·∫≠n Giao d·ªãch';
            }
        };

        /**
         * 5. H√ÄM X√ÅC NH·∫¨N THANH TO√ÅN (B·∫±ng OTP)
         * G·ªçi /api/payment/confirm
         */
        const handleConfirmPayment = async () => {
            hideError(otpError);
            const otpCode = otpCodeInput.value;
            if (otpCode.length !== 6) {
                showError(otpError, 'M√£ OTP ph·∫£i c√≥ 6 ch·ªØ s·ªë.');
                return;
            }

            confirmPaymentBtn.disabled = true;
            confirmPaymentBtn.textContent = 'ƒêang x√°c th·ª±c...';

            try {
                const response = await fetch('/api/payment/confirm', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${jwtToken}` // G·ª¨I TOKEN L√äN
                    },
                    // THAY ƒê·ªîI: Ch·ªâ g·ª≠i studentId v√† otpCode
                    body: JSON.stringify({
                        studentId: currentStudentId,
                        otpCode: otpCode
                    })
                });

                if (!response.ok) {
                    const errorMsg = await response.text();
                    throw new Error(errorMsg);
                }

                const successMsg = await response.text();
                // Hi·ªÉn th·ªã k·∫øt qu·∫£ th√†nh c√¥ng
                resultMessage.textContent = successMsg;
                resultMessage.className = 'message success';
                showView('result-view');
                
            } catch (error) {
                // Hi·ªÉn th·ªã k·∫øt qu·∫£ th·∫•t b·∫°i
                resultMessage.textContent = `Giao d·ªãch Th·∫•t b·∫°i: ${error.message}`;
                resultMessage.className = 'message error';
                showView('result-view');
            } finally {
                confirmPaymentBtn.disabled = false;
                confirmPaymentBtn.textContent = 'Ho√†n t·∫•t Thanh to√°n';
                otpCodeInput.value = '';
            }
        };

        /**
         * 6. H√ÄM XEM L·ªäCH S·ª¨ GIAO D·ªäCH (M·ªöI)
         * G·ªçi /api/payment/history
         */
        const handleViewHistory = async () => {
             if (!jwtToken) return; // Ch∆∞a ƒëƒÉng nh·∫≠p
             
             try {
                const response = await fetch('/api/payment/history', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${jwtToken}` // G·ª¨I TOKEN L√äN
                    }
                });

                if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i l·ªãch s·ª≠ giao d·ªãch.');
                
                const historyList = await response.json();
                
                // X√≥a b·∫£ng c≈©
                historyTableBody.innerHTML = '';
                
                if (historyList.length === 0) {
                    historyTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Kh√¥ng c√≥ l·ªãch s·ª≠ giao d·ªãch.</td></tr>';
                } else {
                    historyList.forEach(tx => {
                        const statusClass = tx.status === 'SUCCESS' ? 'status-success' : 'status-failed';
                        const row = `
                            <tr>
                                <td>${new Date(tx.transactionDate).toLocaleString('vi-VN')}</td>
                                <td>${tx.studentNamePaidFor} (${tx.studentIdPaidFor})</td>
                                <td>${formatCurrency(tx.amount)}</td>
                                <td class="${statusClass}">${tx.status}</td>
                                <td>${tx.description || ''}</td>
                            </tr>
                        `;
                        historyTableBody.innerHTML += row; // Th√™m d√≤ng m·ªõi
                    });
                }
                
                // Hi·ªÉn th·ªã view l·ªãch s·ª≠
                showView('history-view');

             } catch(error) {
                showError(paymentError, error.message);
             }
        };


        // H√†m reset v·ªÅ trang thanh to√°n
        const resetToNewPayment = async () => {
            // Reset c√°c tr∆∞·ªùng input
            studentIdInput.value = '';
            studentNameInput.value = '';
            tuitionAmountInput.value = '';
            paymentSummaryAmountInput.value = '';
            termsCheckbox.checked = false;
            initiatePaymentBtn.disabled = true;
            currentStudentId = null;
            tuitionAmount = 0;
            
            // T·∫£i l·∫°i th√¥ng tin m·ªõi nh·∫•t c·ªßa ng∆∞·ªùi d√πng (s·ªë d∆∞)
            await loadPayerInfo();
            // showView('payment-view'); // (loadPayerInfo ƒë√£ g·ªçi)
        };

        // --- G√°n Event Listeners ---
        loginForm.addEventListener('submit', handleLogin);
        findStudentBtn.addEventListener('click', handleFindStudent);
        termsCheckbox.addEventListener('change', validatePaymentForm);
        
        // K√≠ch ho·∫°t validate khi thay ƒë·ªïi 2 tr∆∞·ªùng n√†y
        studentIdInput.addEventListener('input', () => {
            if (studentIdInput.value === '') resetStudentFields();
        });
        
        initiatePaymentBtn.addEventListener('click', handleInitiatePayment);
        confirmPaymentBtn.addEventListener('click', handleConfirmPayment);
        newPaymentBtn.addEventListener('click', resetToNewPayment);

        // M·ªöI: Listener cho l·ªãch s·ª≠
        viewHistoryBtn.addEventListener('click', handleViewHistory);
        backToPaymentBtn.addEventListener('click', () => showView('payment-view'));
    });
</script>

</body>
</html>